<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ğŸ“Š ØµÙØ­Ø© Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
 --main:#1976d2;
 --bg:#f4f6f9;
 --card:#fff;
}

body{
 font-family:Arial;
 background:var(--bg);
 margin:0;
 padding:15px;
}

h2,h3{
 text-align:center;
 color:var(--main);
}

.card{
 background:var(--card);
 padding:15px;
 border-radius:8px;
 margin-bottom:15px;
}

.stats{
 display:flex;
 gap:10px;
 flex-wrap:wrap;
}

.stats div{
 flex:1;
 background:#eef3fa;
 padding:10px;
 border-radius:6px;
 text-align:center;
 font-weight:bold;
}

table{
 width:100%;
 border-collapse:collapse;
 min-width:700px;
}

th,td{
 border:1px solid #ccc;
 padding:6px;
 text-align:center;
 font-size:13px;
}

th{
 background:var(--main);
 color:#fff;
}

button{
 padding:5px 8px;
 cursor:pointer;
}
</style>
</head>

<body>

<h2>ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</h2>

<!-- ğŸ’° Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
<div class="card stats">
 <div>ğŸ’° Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­<br><span id="total">0</span> Ø¯Ø¬</div>
 <div>ğŸ“… Ø§Ù„ÙŠÙˆÙ…<br><span id="today">0</span> Ø¯Ø¬</div>
 <div>ğŸ“† Ø§Ù„Ø´Ù‡Ø±<br><span id="month">0</span> Ø¯Ø¬</div>
 <div>âŒ ØºÙŠØ± Ù…Ø­ØµÙ„<br><span id="unpaid">0</span> Ø¯Ø¬</div>
</div>

<!-- ğŸ“Š Ø§Ù„Ø±Ø³ÙˆÙ… -->
<div class="card">
 <h3>ğŸ“Š Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h3>
 <canvas id="dailyChart"></canvas>
</div>

<div class="card">
 <h3>ğŸ“Š Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</h3>
 <canvas id="monthlyChart"></canvas>
</div>

<div class="card">
 <h3>ğŸ§¾ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø­Ø³Ø¨ Ø§Ù„Ù…Ù†ØªØ¬</h3>
 <canvas id="productChart"></canvas>
</div>

<!-- ğŸ§¾ Ø¬Ø¯ÙˆÙ„ -->
<div class="card table-wrapper">
 <h3>ğŸ§¾ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©</h3>
 <table>
  <thead>
   <tr>
    <th>Ø§Ù„Ø§Ø³Ù…</th>
    <th>Profil</th>
    <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
    <th>Email</th>
    <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
    <th>Ø§Ù„Ø³Ø¹Ø±</th>
    <th>âœï¸</th>
   </tr>
  </thead>
  <tbody id="rows"></tbody>
 </table>
</div>

<script>
/* ===== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ===== */
let subs = JSON.parse(localStorage.getItem("subs") || "[]");

/* ===== Ø¹Ù†Ø§ØµØ± ===== */
const totalEl  = document.getElementById("total");
const todayEl  = document.getElementById("today");
const monthEl  = document.getElementById("month");
const unpaidEl = document.getElementById("unpaid");
const rowsEl   = document.getElementById("rows");

/* ===== Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ===== */
function calcCash(){
 let total=0,today=0,month=0,unpaid=0;
 let now=new Date();

 subs.forEach(s=>{
  let price=Number(s.price)||0;
  let d=new Date(s.id);

  if(s.paid){
   total+=price;
   if(d.toDateString()===now.toDateString()) today+=price;
   if(d.getMonth()===now.getMonth() && d.getFullYear()===now.getFullYear()) month+=price;
  }else unpaid+=price;
 });

 totalEl.textContent=total;
 todayEl.textContent=today;
 monthEl.textContent=month;
 unpaidEl.textContent=unpaid;
}

/* ===== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø³ÙˆÙ… ===== */
function dailyData(){
 let map={};
 subs.filter(s=>s.paid).forEach(s=>{
  let k=new Date(s.id).toLocaleDateString();
  map[k]=(map[k]||0)+Number(s.price);
 });
 return map;
}

function monthlyData(){
 let map={};
 subs.filter(s=>s.paid).forEach(s=>{
  let d=new Date(s.id);
  let k=d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0");
  map[k]=(map[k]||0)+Number(s.price);
 });
 return map;
}

function productData(){
 let map={};
 subs.filter(s=>s.paid).forEach(s=>{
  map[s.product]=(map[s.product]||0)+Number(s.price);
 });
 return map;
}

/* ===== Ø±Ø³Ù… Ø§Ù„Ø±Ø³ÙˆÙ… ===== */
function drawCharts(){
 let d=dailyData();
 new Chart(dailyChart,{
  type:"line",
  data:{labels:Object.keys(d),datasets:[{label:"Ø¯Ø¬",data:Object.values(d)}]}
 });

 let m=monthlyData();
 new Chart(monthlyChart,{
  type:"bar",
  data:{labels:Object.keys(m),datasets:[{label:"Ø¯Ø¬",data:Object.values(m)}]}
 });

 let p=productData();
 new Chart(productChart,{
  type:"pie",
  data:{labels:Object.keys(p),datasets:[{data:Object.values(p)}]}
 });
}

/* ===== Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ===== */
function renderTable(){
 rowsEl.innerHTML="";
 subs.filter(s=>s.paid).forEach(s=>{
  rowsEl.innerHTML+=`
<tr>
 <td>${s.name}</td>
 <td>${s.profile || "-"}</td>
 <td>${s.phone}</td>
 <td>${s.email || "-"}</td>
 <td>${s.product}</td>
 <td>${s.price} Ø¯Ø¬</td>
 <td><button onclick="editSub(${s.id})">âœï¸</button></td>
</tr>`;
 });
}

/* ===== ØªØ¹Ø¯ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ===== */
function editSub(id){
 let s=subs.find(x=>x.id===id);
 if(!s)return;

 let name=prompt("Ø§Ù„Ø§Ø³Ù…",s.name); if(name===null)return;
 let profile=prompt("Profil (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)",s.profile||"");
 let phone=prompt("Ø§Ù„Ù‡Ø§ØªÙ",s.phone); if(phone===null)return;
 let email=prompt("Email",s.email||"");
 let product=prompt("Ø§Ù„Ù…Ù†ØªØ¬",s.product); if(product===null)return;
 let price=prompt("Ø§Ù„Ø³Ø¹Ø±",s.price); if(price===null)return;

 s.name=name;
 s.profile=profile;
 s.phone=phone;
 s.email=email;
 s.product=product;
 s.price=price;

 localStorage.setItem("subs",JSON.stringify(subs));
 renderTable();
 calcCash();
}

/* ===== ØªØ´ØºÙŠÙ„ ===== */
calcCash();
renderTable();
drawCharts();
</script>

</body>
</html>
