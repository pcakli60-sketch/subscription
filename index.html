<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</title>

<style>
:root{
 --main:#1976d2;
 --bg:#f4f6f9;
 --card:#fff;
 --warn:#fff3cd;
 --danger:#f8d7da;
 --unpaid:#fdecea;
}

body{
 font-family:Arial;
 background:var(--bg);
 margin:0;
 padding:15px;
}

h2{text-align:center;color:var(--main)}

.card{
 background:var(--card);
 padding:15px;
 border-radius:8px;
 margin-bottom:15px;
}

input,select,button{
 width:100%;
 padding:10px;
 margin:5px 0;
 font-size:14px;
}

button{
 background:var(--main);
 color:#fff;
 border:none;
 border-radius:5px;
 cursor:pointer;
}

.filters,.stats{
 display:flex;
 gap:5px;
 flex-wrap:wrap;
}

.stats div{
 flex:1;
 background:#eef3fa;
 padding:10px;
 border-radius:6px;
 text-align:center;
}

table{
 width:100%;
 border-collapse:collapse;
 min-width:1000px;
}

th,td{
 border:1px solid #ccc;
 padding:6px;
 text-align:center;
 font-size:13px;
 white-space:nowrap;
}

th{background:var(--main);color:#fff}

.warn{background:var(--warn)}
.danger{background:var(--danger)}
.unpaid{background:var(--unpaid)}

.days{
 padding:4px 8px;
 border-radius:12px;
 font-weight:bold;
}
.ok{background:#e8f5e9;color:#2e7d32}
.warnDays{background:#fff3e0;color:#ef6c00}
.expired{background:#fdecea;color:#c62828}
</style>
</head>

<body>

<h2>ğŸ“Š Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</h2>

<input id="search" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… / Ø§Ù„Ù‡Ø§ØªÙ / Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„" onkeyup="render()">

<div class="filters">
 <button onclick="setFilter('all')">Ø§Ù„ÙƒÙ„</button>
 <button onclick="setFilter('active')">Ù†Ø´Ø·</button>
 <button onclick="setFilter('expired')">Ù…Ù†ØªÙ‡ÙŠ</button>
 <button onclick="setFilter('unpaid')">ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹</button>
 <button onclick="toggleNotify()">ğŸ”” Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</button>
</div>

<div class="card stats">
 <div>ğŸ“¦ Ø§Ù„ÙƒÙ„<br><b id="stTotal">0</b></div>
 <div>ğŸŸ¢ Ù†Ø´Ø·<br><b id="stActive">0</b></div>
 <div>ğŸ”´ Ù…Ù†ØªÙ‡ÙŠ<br><b id="stExpired">0</b></div>
 <div>âŒ ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹<br><b id="stUnpaid">0</b></div>
</div>

<div class="card">
 <input id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†">
 <input id="phone" type="tel" placeholder="Ø§Ù„Ù‡Ø§ØªÙ">
 <input id="email" placeholder="Email">
 <select id="product">
  <option value="">Ø§Ù„Ù…Ù†ØªØ¬</option>
  <option>Netflix</option>
  <option>Shahid</option>
  <option>IPTV</option>
 </select>
 <input id="price" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±">
 <input id="days" type="number" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…">
 <button onclick="addSub()">â• Ø¥Ø¶Ø§ÙØ© Ø§Ø´ØªØ±Ø§Ùƒ</button>
</div>

<div class="card">
 <button onclick="exportData()">ğŸ“¤ ØªØµØ¯ÙŠØ± Ù†Ø³Ø®Ø©</button>
 <input type="file" onchange="importData(this)" />
</div>

<div class="card" style="overflow:auto">
<table>
<thead>
<tr>
 <th>Ø§Ù„Ø§Ø³Ù…</th>
 <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
 <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
 <th>Ø§Ù„Ø³Ø¹Ø±</th>
 <th>Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th>
 <th>â³ Ø§Ù„Ø£ÙŠØ§Ù…</th>
 <th>Ù…Ø¯ÙÙˆØ¹</th>
 <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
</tr>
</thead>
<tbody id="list"></tbody>
</table>
</div>

<script>
let subs=JSON.parse(localStorage.getItem("subs")||"[]");
let filter="all";
let notify=false;

const qs=id=>document.getElementById(id);
const safe=t=>t.replace(/[<>&"]/g,c=>({'<':'&lt;','>':'&gt;','&':'&amp;','"':'&quot;'}[c]));

function save(){localStorage.setItem("subs",JSON.stringify(subs));}
function setFilter(f){filter=f;render();}
function toggleNotify(){notify=!notify;alert(notify?"ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª":"ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª");}

function addSub(){
 if(!name.value||!phone.value||!product.value||days.value<=0)return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
 let start=new Date();start.setHours(0,0,0,0);
 let end=new Date(start);end.setDate(end.getDate()+Number(days.value));
 subs.push({
  id:Date.now(),
  name:safe(name.value),
  phone:safe(phone.value),
  product:product.value,
  price:price.value,
  end:end.toISOString(),
  paid:false,n3:false,n0:false
 });
 save();location.reload();
}

function renew(id){
 let d=prompt("Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„ØªØ¬Ø¯ÙŠØ¯"); if(!d)return;
 let s=subs.find(x=>x.id===id);
 let e=new Date(s.end); e.setDate(e.getDate()+Number(d));
 s.end=e.toISOString(); s.n3=s.n0=false;
 save();render();
}

function render(){
 let list=qs("list"); list.innerHTML="";
 let today=new Date();today.setHours(0,0,0,0);
 subs.sort((a,b)=>new Date(a.end)-new Date(b.end));

 let t=0,a=0,e=0,u=0;

 subs.forEach(s=>{
  let end=new Date(s.end); end.setHours(0,0,0,0);
  let diff=Math.floor((end-today)/86400000);

  t++; diff<0?e++:a++; if(!s.paid)u++;

  if(filter==="active"&&diff<0)return;
  if(filter==="expired"&&diff>=0)return;
  if(filter==="unpaid"&&s.paid)return;

  if(notify){
   if(diff===3&&!s.n3){send(s,diff);s.n3=true}
   if(diff===0&&!s.n0){send(s,diff);s.n0=true}
  }

  let cls=diff<0?"expired":diff<=3?"warnDays":"ok";

  list.innerHTML+=`
<tr class="${diff<0?'danger':diff<=3?'warn':''} ${!s.paid?'unpaid':''}">
<td>${s.name}</td>
<td>${s.phone}</td>
<td>${s.product}</td>
<td>${s.price}</td>
<td>${end.toLocaleDateString()}</td>
<td><span class="days ${cls}">${diff}</span></td>
<td><input type="checkbox" ${s.paid?"checked":""} onclick="s=subs.find(x=>x.id===${s.id});s.paid=!s.paid;save();render()"></td>
<td>
<button onclick="send(subs.find(x=>x.id===${s.id}),${diff})">ğŸ’¬</button>
<button onclick="renew(${s.id})">â™»ï¸</button>
<button onclick="subs=subs.filter(x=>x.id!==${s.id});save();render()">ğŸ—‘</button>
</td>
</tr>`;
 });

 stTotal.textContent=t;
 stActive.textContent=a;
 stExpired.textContent=e;
 stUnpaid.textContent=u;
}

function send(s,d){
 let msg=`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${s.name}
Ø§Ø´ØªØ±Ø§Ùƒ ${s.product}
${d<=0?"Ù…Ù†ØªÙ‡ÙŠ":"ÙŠÙ†ØªÙ‡ÙŠ Ù‚Ø±ÙŠØ¨Ø§Ù‹"}
Ø§Ù„Ø£ÙŠØ§Ù…: ${d}`;
 window.open(`https://wa.me/${s.phone}?text=${encodeURIComponent(msg)}`);
}

function exportData(){
 let b=new Blob([JSON.stringify(subs)],{type:"application/json"});
 let a=document.createElement("a");
 a.href=URL.createObjectURL(b); a.download="backup.json"; a.click();
}

function importData(i){
 let r=new FileReader();
 r.onload=()=>{subs=JSON.parse(r.result);save();render();}
 r.readAsText(i.files[0]);
}

render();
</script>
</body>
</html>
