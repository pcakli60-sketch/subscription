<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ğŸ“Š Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
 font-family:Arial;
 background:#f4f6f9;
 padding:15px;
}
h2,h3{text-align:center;color:#1976d2}
.card{
 background:#fff;
 padding:15px;
 border-radius:8px;
 margin-bottom:15px;
}
.stats{
 display:flex;
 gap:10px;
 flex-wrap:wrap;
}
.stats div{
 flex:1;
 background:#eef3fa;
 padding:10px;
 border-radius:6px;
 text-align:center;
 font-weight:bold;
}
table{
 width:100%;
 border-collapse:collapse;
}
th,td{
 border:1px solid #ccc;
 padding:6px;
 text-align:center;
 font-size:13px;
}
th{background:#1976d2;color:#fff}
</style>
</head>

<body>

<h2>ğŸ“Š ØµÙØ­Ø© Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ (Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·)</h2>

<!-- ğŸ’° Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
<div class="card stats">
 <div>ğŸ’° Ø§Ù„ÙƒÙ„<br><span id="total">0</span> Ø¯Ø¬</div>
 <div>ğŸ“… Ø§Ù„ÙŠÙˆÙ…<br><span id="today">0</span> Ø¯Ø¬</div>
 <div>ğŸ“† Ø§Ù„Ø´Ù‡Ø±<br><span id="month">0</span> Ø¯Ø¬</div>
 <div>âŒ ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹<br><span id="unpaid">0</span> Ø¯Ø¬</div>
</div>

<div class="card"><h3>ğŸ“Š ÙŠÙˆÙ…ÙŠ</h3><canvas id="daily"></canvas></div>
<div class="card"><h3>ğŸ“Š Ø´Ù‡Ø±ÙŠ</h3><canvas id="monthly"></canvas></div>
<div class="card"><h3>ğŸ§¾ Ø­Ø³Ø¨ Ø§Ù„Ù…Ù†ØªØ¬</h3><canvas id="product"></canvas></div>

<div class="card">
<h3>ğŸ§¾ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©</h3>
<table>
<thead>
<tr>
 <th>Ø§Ù„Ø§Ø³Ù…</th>
 <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
 <th>Ø§Ù„Ø³Ø¹Ø±</th>
 <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>
</div>

<script>
const subs = JSON.parse(localStorage.getItem("subs")||"[]");

const totalEl=document.getElementById("total");
const todayEl=document.getElementById("today");
const monthEl=document.getElementById("month");
const unpaidEl=document.getElementById("unpaid");
const rows=document.getElementById("rows");

function calc(){
 let total=0,today=0,month=0,unpaid=0;
 let now=new Date();

 subs.forEach(s=>{
  let price=Number(s.price)||0;
  let d=new Date(s.id);

  if(s.paid){
   total+=price;
   if(d.toDateString()===now.toDateString()) today+=price;
   if(d.getMonth()===now.getMonth() && d.getFullYear()===now.getFullYear()) month+=price;
  }else unpaid+=price;
 });

 totalEl.textContent=total;
 todayEl.textContent=today;
 monthEl.textContent=month;
 unpaidEl.textContent=unpaid;
}

function mapData(keyFn){
 let m={};
 subs.filter(s=>s.paid).forEach(s=>{
  let k=keyFn(s);
  m[k]=(m[k]||0)+Number(s.price);
 });
 return m;
}

function draw(){
 let d=mapData(s=>new Date(s.id).toLocaleDateString());
 new Chart(daily,{type:"line",data:{labels:Object.keys(d),datasets:[{data:Object.values(d)}]}});

 let m=mapData(s=>{
  let x=new Date(s.id);
  return x.getFullYear()+"-"+(x.getMonth()+1);
 });
 new Chart(monthly,{type:"bar",data:{labels:Object.keys(m),datasets:[{data:Object.values(m)}]}});

 let p=mapData(s=>s.product);
 new Chart(product,{type:"pie",data:{labels:Object.keys(p),datasets:[{data:Object.values(p)}]}});
}

function table(){
 rows.innerHTML="";
 subs.filter(s=>s.paid).forEach(s=>{
  rows.innerHTML+=`
<tr>
 <td>${s.name}</td>
 <td>${s.product}</td>
 <td>${s.price}</td>
 <td>${new Date(s.id).toLocaleDateString()}</td>
</tr>`;
 });
}

calc();
table();
draw();
</script>

</body>
</html>
