<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>نظام إدارة الاشتراكات</title>

<style>
:root{
 --main:#1976d2;
 --bg:#f4f6f9;
 --card:#fff;
 --warn:#fff3cd;
 --danger:#f8d7da;
 --unpaid:#fdecea;
}
body{
 font-family:Arial;
 background:var(--bg);
 padding:15px;
}
h2{text-align:center;color:var(--main)}
.card{
 background:var(--card);
 padding:15px;
 border-radius:8px;
 margin-bottom:15px;
}
input,select,button{
 width:100%;
 padding:10px;
 margin:5px 0;
}
button{
 background:var(--main);
 color:#fff;
 border:none;
 border-radius:5px;
 cursor:pointer;
}
.filters,.stats{
 display:flex;
 gap:5px;
 flex-wrap:wrap;
}
.stats div{
 flex:1;
 background:#eef3fa;
 padding:10px;
 text-align:center;
 border-radius:6px;
}
.table-wrapper{overflow-x:auto}
table{
 width:100%;
 border-collapse:collapse;
 min-width:1000px;
}
th,td{
 border:1px solid #ccc;
 padding:6px;
 text-align:center;
 white-space:nowrap;
}
th{background:var(--main);color:#fff}
.warn{background:var(--warn)}
.danger{background:var(--danger)}
.unpaid{background:var(--unpaid)}
.actions{
 position:sticky;
 right:0;
 background:#fff;
}
.days-box{
 padding:4px 8px;
 border-radius:12px;
 font-weight:bold;
}
.days-ok{background:#e8f5e9;color:#2e7d32}
.days-warn{background:#fff3e0;color:#ef6c00}
.days-expired{background:#fdecea;color:#c62828}
</style>
</head>

<body>

<h2>إدارة الاشتراكات</h2>

<input id="search" placeholder="بحث..." onkeyup="render()">

<div class="filters">
 <button onclick="setFilter('all')">الكل</button>
 <button onclick="setFilter('active')">نشط</button>
 <button onclick="setFilter('expired')">منتهي</button>
 <button onclick="setFilter('unpaid')">غير مدفوع</button>
</div>

<div class="card stats">
 <div>الكل<br><b id="stTotal">0</b></div>
 <div>نشط<br><b id="stActive">0</b></div>
 <div>منتهي<br><b id="stExpired">0</b></div>
 <div>غير مدفوع<br><b id="stUnpaid">0</b></div>
</div>

<div class="card">
 <input id="name" placeholder="اسم الزبون">
 <input id="phone" placeholder="الهاتف">
 <input id="email" placeholder="Email">
 <select id="product">
  <option value="">المنتج</option>
  <option>Netflix</option>
  <option>Shahid</option>
  <option>IPTV</option>
 </select>
 <input id="price" type="number" placeholder="السعر">
 <input id="daysInput" type="number" placeholder="عدد أيام الاشتراك">
 <button onclick="addSub()">➕ إضافة اشتراك</button>
</div>

<div class="card table-wrapper">
<table>
<thead>
<tr>
 <th>الاسم</th>
 <th>الهاتف</th>
 <th>Email</th>
 <th>المنتج</th>
 <th>السعر</th>
 <th>الانتهاء</th>
 <th>الأيام</th>
 <th>مدفوع</th>
 <th>إجراءات</th>
</tr>
</thead>
<tbody id="list"></tbody>
</table>
</div>

<script>
let subs = JSON.parse(localStorage.getItem("subs") || "[]");
let currentFilter = "all";

function save(){
 localStorage.setItem("subs", JSON.stringify(subs));
}

function setFilter(f){
 currentFilter = f;
 render();
}

function fmt(d){
 return d.getFullYear()+"/"+
 String(d.getMonth()+1).padStart(2,"0")+"/"+
 String(d.getDate()).padStart(2,"0");
}

function addSub(){
 let days = Number(daysInput.value);

 if(
  name.value.trim()==="" ||
  phone.value.trim()==="" ||
  product.value==="" ||
  Number(price.value)<=0 ||
  days<=0
 ){
  alert("يرجى ملء جميع الحقول");
  return;
 }

 let start=new Date();
 start.setHours(0,0,0,0);
 let end=new Date(start);
 end.setDate(end.getDate()+days);

 subs.push({
  id:Date.now(),
  name:name.value,
  phone:phone.value,
  email:email.value,
  product:product.value,
  price:price.value,
  end:end.toISOString(),
  paid:false
 });

 save();
 name.value=phone.value=email.value=price.value=daysInput.value="";
 product.value="";
 render();
}

function togglePaid(id){
 let s=subs.find(x=>x.id===id);
 s.paid=!s.paid;
 save();render();
}

function render(){
 list.innerHTML="";
 let today=new Date(); today.setHours(0,0,0,0);
 let q=search.value.toLowerCase();

 let total=0,active=0,expired=0,unpaid=0;

 subs.forEach(s=>{
  let end=new Date(s.end); end.setHours(0,0,0,0);
  let diff=Math.floor((end-today)/86400000);

  total++;
  diff<0?expired++:active++;
  if(!s.paid) unpaid++;

  if(currentFilter==="active" && diff<0)return;
  if(currentFilter==="expired" && diff>=0)return;
  if(currentFilter==="unpaid" && s.paid)return;

  if(q && !(`${s.name}${s.phone}${s.email}`.toLowerCase().includes(q)))return;

  let tr=document.createElement("tr");
  tr.innerHTML=`
<td>${s.name}</td>
<td>${s.phone}</td>
<td>${s.email||"-"}</td>
<td>${s.product}</td>
<td>${s.price}</td>
<td>${fmt(end)}</td>
<td><span class="days-box ${
 diff<0?'days-expired':diff<=3?'days-warn':'days-ok'
}">${diff}</span></td>
<td><input type="checkbox" ${s.paid?"checked":""} onclick="togglePaid(${s.id})"></td>
<td class="actions">
 <button onclick="togglePaid(${s.id})">✔</button>
</td>`;
  list.appendChild(tr);
 });

 stTotal.textContent=total;
 stActive.textContent=active;
 stExpired.textContent=expired;
 stUnpaid.textContent=unpaid;
}

render();
</script>

</body>
</html>
