<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</title>

<style>
:root{
 --main:#1976d2;
 --bg:#f4f6f9;
 --card:#fff;
 --warn:#fff3cd;
 --danger:#f8d7da;
 --unpaid:#fdecea;
}
body{
 font-family:Arial;
 background:var(--bg);
 margin:0;
 padding:15px;
}
h2{
 text-align:center;
 color:var(--main);
 margin-bottom:10px;
}
.card{
 background:var(--card);
 padding:15px;
 border-radius:8px;
 margin-bottom:15px;
}
input,select,button{
 width:100%;
 padding:10px;
 margin:5px 0;
 font-size:14px;
}
button{
 background:var(--main);
 color:#fff;
 border:none;
 border-radius:5px;
 cursor:pointer;
}
.filters,.stats{
 display:flex;
 gap:5px;
 flex-wrap:wrap;
}
.filters button,.stats div{
 flex:1;
}
.stats div{
 background:#eef3fa;
 padding:10px;
 border-radius:6px;
 text-align:center;
}
.table-wrapper{overflow-x:auto}
table{
 width:100%;
 border-collapse:collapse;
 min-width:1100px;
}
th,td{
 border:1px solid #ccc;
 padding:6px;
 text-align:center;
 white-space:nowrap;
 font-size:13px;
}
th{background:var(--main);color:#fff}
.warn{background:var(--warn)}
.danger{background:var(--danger)}
.unpaid{background:var(--unpaid)}
.actions{
 position:sticky;
 right:0;
 background:#fff;
 z-index:2;
}
.actions button{
 padding:5px 8px;
 margin:2px;
}
.days-box{
 padding:4px 8px;
 border-radius:12px;
 font-weight:bold;
}
.days-ok{background:#e8f5e9;color:#2e7d32}
.days-warn{background:#fff3e0;color:#ef6c00}
.days-expired{background:#fdecea;color:#c62828}
</style>
</head>

<body>

<h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</h2>

<input id="search" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… / Ø§Ù„Ù‡Ø§ØªÙ / Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„" onkeyup="render()">

<div class="filters">
 <button onclick="setFilter('all')">Ø§Ù„ÙƒÙ„</button>
 <button onclick="setFilter('active')">Ù†Ø´Ø·</button>
 <button onclick="setFilter('expired')">Ù…Ù†ØªÙ‡ÙŠ</button>
 <button onclick="setFilter('unpaid')">ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹</button>
</div>

<div class="card">
 <button onclick="sendGroup('active')">ğŸ“© Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù…ÙØ¹Ù‘Ù„ÙŠÙ†</button>
 <button onclick="sendGroup('expired')">ğŸ“© Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù…Ù†ØªÙ‡ÙŠÙŠÙ†</button>
</div>

<div class="card stats">
 <div>ğŸ“¦ Ø§Ù„ÙƒÙ„<br><b id="stTotal">0</b></div>
 <div>ğŸŸ¢ Ù†Ø´Ø·<br><b id="stActive">0</b></div>
 <div>ğŸ”´ Ù…Ù†ØªÙ‡ÙŠ<br><b id="stExpired">0</b></div>
 <div>âŒ ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹<br><b id="stUnpaid">0</b></div>
</div>

<div class="card">
 <input id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†">
 <input id="phone" placeholder="Ø§Ù„Ù‡Ø§ØªÙ">
 <input id="email" placeholder="Email">
 <select id="product">
  <option value="">Ø§Ù„Ù…Ù†ØªØ¬</option>
  <option>Netflix</option>
  <option>Shahid</option>
  <option>IPTV</option>
 </select>
 <input id="price" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø± (Ø¯Ø¬)">
 <input id="days" type="number" placeholder="Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ">
 <button onclick="addSub()">â• Ø¥Ø¶Ø§ÙØ© Ø§Ø´ØªØ±Ø§Ùƒ</button>
</div>

<div class="card table-wrapper">
<table>
<thead>
<tr>
 <th>Ø§Ù„Ø§Ø³Ù…</th>
 <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
 <th>Email</th>
 <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
 <th>Ø§Ù„Ø³Ø¹Ø±</th>
 <th>Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th>
 <th>â³ Ø§Ù„Ø£ÙŠØ§Ù…</th>
 <th>Ù…Ø¯ÙÙˆØ¹</th>
 <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
</tr>
</thead>
<tbody id="list"></tbody>
</table>
</div>

<script>
const $ = id => document.getElementById(id);

let subs = JSON.parse(localStorage.getItem("subs") || "[]");
let currentFilter="all";

function save(){localStorage.setItem("subs",JSON.stringify(subs));}
function setFilter(f){currentFilter=f;render();}

function fmt(d){
 return d.getFullYear()+"/"+String(d.getMonth()+1).padStart(2,"0")+"/"+String(d.getDate()).padStart(2,"0");
}

function sendWhatsApp(phone,name,product,end,days){
 let msg="";
 if(days>=0){
  msg=
`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${name} ğŸ‘‹

Ù†ÙˆØ¯ Ø¥Ø¹Ù„Ø§Ù…ÙƒÙ… Ø£Ù† Ø§Ø´ØªØ±Ø§ÙƒÙƒÙ… ÙÙŠ Ø®Ø¯Ù…Ø© ${product}
Ø³ÙŠÙ†ØªÙ‡ÙŠ Ø¨ØªØ§Ø±ÙŠØ® ${end} â°

â³ Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: ${days} Ø£ÙŠØ§Ù…

ğŸ“Œ ÙÙŠ Ø­Ø§Ù„ Ø§Ù„Ø±ØºØ¨Ø© ÙÙŠ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ Ø£Ùˆ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø±
ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©.

Ù†Ø­Ù† ÙÙŠ Ø®Ø¯Ù…ØªÙƒÙ… Ø¯Ø§Ø¦Ù…Ø§Ù‹ ğŸŒŸ`;
 }else{
  msg=
`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${name} ğŸ‘‹

Ù†ÙˆØ¯ Ø¥Ø¹Ù„Ø§Ù…ÙƒÙ… Ø£Ù† Ø§Ø´ØªØ±Ø§ÙƒÙƒÙ… ÙÙŠ Ø®Ø¯Ù…Ø© ${product}
Ù‚Ø¯ Ø§Ù†ØªÙ‡Ù‰ Ø¨ØªØ§Ø±ÙŠØ® ${end} âŒ

ğŸ“Œ ÙÙŠ Ø­Ø§Ù„ Ø§Ù„Ø±ØºØ¨Ø© ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©.

Ù†Ø­Ù† ÙÙŠ Ø®Ø¯Ù…ØªÙƒÙ… Ø¯Ø§Ø¦Ù…Ø§Ù‹ ğŸŒŸ`;
 }
 window.open("https://wa.me/"+phone+"?text="+encodeURIComponent(msg),"_blank");
}

function addSub(){
 let name=$("name").value, phone=$("phone").value, email=$("email").value,
 product=$("product").value, price=$("price").value, days=$("days").value;
 if(!name||!phone||!product||days<=0) return alert("Ø§Ù…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„");
 let start=new Date(); start.setHours(0,0,0,0);
 let end=new Date(start); end.setDate(end.getDate()+Number(days));
 subs.push({id:Date.now(),name,phone,email,product,price,end:end.toISOString(),paid:false});
 save(); location.reload();
}

function editSub(id){
 let s=subs.find(x=>x.id===id);
 s.name=prompt("Ø§Ù„Ø§Ø³Ù…",s.name)||s.name;
 s.phone=prompt("Ø§Ù„Ù‡Ø§ØªÙ",s.phone)||s.phone;
 s.email=prompt("Email",s.email)||s.email;
 save(); render();
}

function renewSub(id){
 let s=subs.find(x=>x.id===id);
 let d=prompt("Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„ØªØ¬Ø¯ÙŠØ¯:");
 if(!d||isNaN(d)||d<=0)return;
 let end=new Date(s.end), today=new Date();
 if(end<today) end=today;
 end.setDate(end.getDate()+Number(d));
 s.end=end.toISOString();
 save(); render();
 sendWhatsApp(s.phone,s.name,s.product,fmt(end),d);
}

function sendGroup(type){
 let today=new Date(); today.setHours(0,0,0,0);
 let list=subs.filter(s=>{
  let end=new Date(s.end); end.setHours(0,0,0,0);
  let diff=Math.floor((end-today)/86400000);
  if(type==="active" && diff<0) return false;
  if(type==="expired" && diff>=0) return false;
  return true;
 });
 if(!list.length) return alert("Ù…Ø§ ÙƒØ§Ø´ Ù…Ø´ØªØ±ÙƒÙŠÙ†");
 if(!confirm("Ø±Ø§Ø­ ØªØ¨Ø¹Ø« Ø±Ø³Ø§Ø¦Ù„ Ù„Ù€ "+list.length+" Ù…Ø´ØªØ±Ùƒ")) return;
 list.forEach((s,i)=>{
  let end=new Date(s.end);
  let diff=Math.floor((end-today)/86400000);
  setTimeout(()=>sendWhatsApp(s.phone,s.name,s.product,fmt(end),diff),i*1200);
 });
}

function render(){
 $("list").innerHTML="";
 let today=new Date(); today.setHours(0,0,0,0);
 let q=$("search").value.toLowerCase();
 let t=0,a=0,e=0,u=0;

 subs.forEach(s=>{
  let end=new Date(s.end); end.setHours(0,0,0,0);
  let diff=Math.floor((end-today)/86400000);

  t++; diff<0?e++:a++; if(!s.paid)u++;
  if(currentFilter==="active"&&diff<0)return;
  if(currentFilter==="expired"&&diff>=0)return;
  if(currentFilter==="unpaid"&&s.paid)return;
  if(q&&!(`${s.name}${s.phone}${s.email}`.toLowerCase().includes(q)))return;

  let tr=document.createElement("tr");
  if(diff<0)tr.classList.add("danger");
  else if(diff<=3)tr.classList.add("warn");
  if(!s.paid)tr.classList.add("unpaid");

  tr.innerHTML=`
<td>${s.name}</td>
<td>${s.phone}</td>
<td>${s.email||"-"}</td>
<td>${s.product}</td>
<td>${s.price||"-"}</td>
<td>${fmt(end)}</td>
<td><span class="days-box ${diff<0?'days-expired':diff<=3?'days-warn':'days-ok'}">${diff}</span></td>
<td><input type="checkbox" ${s.paid?"checked":""} onclick="s.paid=!s.paid;save();render()"></td>
<td class="actions">
 <button onclick="sendWhatsApp('${s.phone}','${s.name}','${s.product}','${fmt(end)}',${diff})">ğŸ’¬</button>
 <button onclick="editSub(${s.id})">âœï¸</button>
 <button onclick="renewSub(${s.id})">ğŸ”„</button>
 <button onclick="subs=subs.filter(x=>x.id!==${s.id});save();render()">ğŸ—‘</button>
</td>`;
  $("list").appendChild(tr);
 });

 $("stTotal").textContent=t;
 $("stActive").textContent=a;
 $("stExpired").textContent=e;
 $("stUnpaid").textContent=u;
}

render();
</script>

</body>
</html>
