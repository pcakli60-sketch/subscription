<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</title>

<style>
:root{
 --bg:#f4f6f9;--card:#fff;--main:#1976d2;--text:#000;
 --warn:#fff3cd;--danger:#f8d7da;--unpaid:#fdecea;
}
body{
 font-family:Arial;background:var(--bg);color:var(--text);
 padding:20px
}
h2{text-align:center;color:var(--main)}
.card{
 background:var(--card);padding:15px;border-radius:8px;margin-bottom:15px
}
input,select,button{
 width:100%;padding:10px;margin:5px 0
}
button{
 background:var(--main);color:#fff;border:none;cursor:pointer
}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
th{background:var(--main);color:#fff}
.warn{background:var(--warn)}
.danger{background:var(--danger)}
.unpaid{background:var(--unpaid)}
.actions button{width:auto;margin:2px}
.filters{display:flex;gap:5px;flex-wrap:wrap}
.stats{display:flex;gap:10px;flex-wrap:wrap}
.stat{flex:1;text-align:center}
.table-wrapper{overflow-x:auto}
@media(max-width:768px){
 table{min-width:900px}
}
.actions{
 position:sticky;
 right:0;
 background:var(--card)
}
</style>
</head>

<body>

<h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</h2>

<!-- ğŸ” Ø§Ù„Ø¨Ø­Ø« -->
<input id="search" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… / Ø§Ù„Ù‡Ø§ØªÙ / Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„" onkeyup="render()">

<!-- ğŸ” Ø§Ù„ÙÙ„Ø§ØªØ± -->
<div class="filters">
  <button onclick="setFilter('all')">Ø§Ù„ÙƒÙ„</button>
  <button onclick="setFilter('active')">Ù†Ø´Ø·</button>
  <button onclick="setFilter('expired')">Ù…Ù†ØªÙ‡ÙŠ</button>
  <button onclick="setFilter('unpaid')">âŒ ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹</button>
</div>

<!-- ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
<div class="card stats">
  <div class="stat">ğŸ“¦ Ø§Ù„ÙƒÙ„<br><b id="stTotal">0</b></div>
  <div class="stat">ğŸŸ¢ Ù†Ø´Ø·<br><b id="stActive">0</b></div>
  <div class="stat">ğŸ”´ Ù…Ù†ØªÙ‡ÙŠ<br><b id="stExpired">0</b></div>
  <div class="stat">âŒ ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹<br><b id="stUnpaid">0</b></div>
</div>

<!-- â• Ø¥Ø¶Ø§ÙØ© -->
<div class="card">
  <input id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†">
  <input id="phone" placeholder="Ø§Ù„Ù‡Ø§ØªÙ">
  <input id="email" placeholder="Email">
  <select id="product">
    <option value="">Ø§Ù„Ù…Ù†ØªØ¬</option>
    <option>Netflix</option>
    <option>Shahid</option>
    <option>IPTV</option>
  </select>
  <input id="price" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±">
  <button onclick="addSub()">â• Ø¥Ø¶Ø§ÙØ© Ø§Ø´ØªØ±Ø§Ùƒ (30 ÙŠÙˆÙ…)</button>
</div>

<!-- ğŸ“‹ Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
<div class="card table-wrapper">
<table>
<thead>
<tr>
<th>Ø§Ù„Ø§Ø³Ù…</th>
<th>Ø§Ù„Ù‡Ø§ØªÙ</th>
<th>Email</th>
<th>Ø§Ù„Ù…Ù†ØªØ¬</th>
<th>Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th>
<th>Ø§Ù„Ø£ÙŠØ§Ù…</th>
<th>Ù…Ø¯ÙÙˆØ¹</th>
<th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
</tr>
</thead>
<tbody id="list"></tbody>
</table>
</div>

<script>
let subs = JSON.parse(localStorage.getItem("subs") || "[]");
let currentFilter = "all";

function save(){
  localStorage.setItem("subs", JSON.stringify(subs));
}

/* ğŸ’¬ WhatsApp */
function sendWhatsApp(phone,name,product,endDate,days){
  const msg=`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${name}
Ø§Ø´ØªØ±Ø§Ùƒ ${product}
${days===0?"Ø§Ù†ØªÙ‡Ù‰ âŒ":"Ø³ÙŠÙ†ØªÙ‡ÙŠ Ø¨Ø¹Ø¯ "+days+" Ø£ÙŠØ§Ù…"}
ğŸ“… ${endDate}
ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù„Ù„ØªØ¬Ø¯ÙŠØ¯`;
  window.open(`https://wa.me/${phone}?text=${encodeURIComponent(msg)}`,"_blank");
}

/* â• Ø¥Ø¶Ø§ÙØ© */
function addSub(){
  if(!name.value||!phone.value||!product.value||price.value<=0){
    alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");return;
  }
  let start=new Date();start.setHours(0,0,0,0);
  let end=new Date(start);end.setDate(end.getDate()+30);

  subs.push({
    id:Date.now(),
    name:name.value,
    phone:phone.value,
    email:email.value,
    product:product.value,
    price:price.value,
    end:end.toISOString(),
    paid:false,
    n3:false,
    n0:false
  });

  save();
  name.value=phone.value=email.value=price.value="";
  product.value="";
  render();
}

/* ğŸ” Ø¯ÙØ¹ */
function togglePaid(id){
  let s=subs.find(x=>x.id===id);
  s.paid=!s.paid;
  save();
  render();
}

/* ğŸ” ÙÙ„ØªØ±Ø© */
function setFilter(f){
  currentFilter=f;
  render();
}

/* ğŸ“… */
function fmt(d){
 return d.getFullYear()+"/"+
 String(d.getMonth()+1).padStart(2,"0")+"/"+
 String(d.getDate()).padStart(2,"0");
}

/* ğŸ”„ Ø¹Ø±Ø¶ */
function render(){
 list.innerHTML="";
 let today=new Date();today.setHours(0,0,0,0);
 let q=search.value.toLowerCase();

 let total=0,active=0,expired=0,unpaid=0;

 subs.forEach(s=>{
  let end=new Date(s.end);end.setHours(0,0,0,0);
  let diff=Math.floor((end-today)/86400000);

  total++;
  if(diff<0) expired++; else active++;
  if(!s.paid) unpaid++;

  if(currentFilter==="active" && diff<0) return;
  if(currentFilter==="expired" && diff>=0) return;
  if(currentFilter==="unpaid" && s.paid) return;

  if(q && !(`${s.name}${s.phone}${s.email}`.toLowerCase().includes(q))) return;

  /* ğŸ”” WhatsApp ØªÙ„Ù‚Ø§Ø¦ÙŠ */
  if(diff===3 && !s.n3){
    sendWhatsApp(s.phone,s.name,s.product,fmt(end),diff);
    s.n3=true;save();
  }
  if(diff===0 && !s.n0){
    sendWhatsApp(s.phone,s.name,s.product,fmt(end),diff);
    s.n0=true;save();
  }

  let tr=document.createElement("tr");
  if(diff<0) tr.className="danger";
  else if(diff<=3) tr.className="warn";
  if(!s.paid) tr.classList.add("unpaid");

  tr.innerHTML=`
<td>${s.name}</td>
<td>${s.phone}</td>
<td>${s.email||"-"}</td>
<td>${s.product}</td>
<td>${fmt(end)}</td>
<td>${diff}</td>
<td>
<input type="checkbox" ${s.paid?"checked":""}
 onclick="togglePaid(${s.id})">
</td>
<td class="actions">
<button onclick="sendWhatsApp('${s.phone}','${s.name}','${s.product}','${fmt(end)}',${diff})">ğŸ’¬</button>
</td>`;
  list.appendChild(tr);
 });

 stTotal.textContent=total;
 stActive.textContent=active;
 stExpired.textContent=expired;
 stUnpaid.textContent=unpaid;
}

render();
</script>

</body>
</html>
